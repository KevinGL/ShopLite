{% extends 'base.html.twig' %}

{% block title %}Liste de tous les produits{% endblock %}

{% block body %}
    <div>
        <h1>Liste de tous les produits</h1>

        {% for i in 1..nbPages %}
            <a href="{{ url('app_products', {'page': i}) }}">{{ i }}</a>
        {% endfor %}

        <table>
            <thead>
                <tr>
                    <th>id</th>
                    <th>Nom</th>
                    <th>Prix</th>
                    <th>Exemplaires</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
                {% for product in products %}
                    <tr>
                        <th>{{ product.id }}</th>
                        <td>{{ product.name }}</td>
                        <td>{{ product.price }}</td>
                        <td>{{ product.nbCopies }}</td>
                        <td><a href="{{ url('edit_product', {'id': product.id}) }}">Modifier</a><button id="{{ product.id }}" class="delete">Supprimer</button></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        {% for i in 1..nbPages %}
            <a href="{{ url('app_products', {'page': i}) }}">{{ i }}</a>
        {% endfor %}

        <div>
            <a href="{{ url('add_product') }}">Ajouter un produit</a>
        </div>

        <div id="modal" hidden>
            Confirmation suppression ?
            <div>
                <button id="delete_yes">Oui</button>
                <button id="delete_no">Non</button>
            </div>
        </div>
    </div>

    <script>
        const buttonsDelete = Array.from($(".delete"));
        let idDelete = "";
        
        buttonsDelete.map((b) =>
        {
            $("#" + b.id).click(() =>
            {
                $("#modal").show();
                idDelete = b.id;
            });
        });

        $("#delete_yes").click(() =>
        {
            window.location.href = "/products/delete/" + idDelete;
        });

        $("#delete_no").click(() =>
        {
            $("#modal").hide();
        });
    </script>
{% endblock %}

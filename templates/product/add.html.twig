{% extends 'base.html.twig' %}

{% block title %}Ajouter un produit{% endblock %}

{% block body %}
<div class="max-w-3xl mx-auto bg-white p-8 mt-10 rounded-lg shadow-md">
    <h1 class="text-2xl font-bold mb-6 text-gray-800">➕ Ajouter un produit</h1>

    {{ form_start(form, {'attr': {'class': 'space-y-6'}}) }}
        <div>
            {{ form_label(form.name, 'Nom du produit', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.name, {'attr': {'class': 'mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500'}}) }}
        </div>

        <div>
            {{ form_label(form.image, 'URL de l\'image', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.image, {'attr': {'class': 'mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 bg-gray-50'}}) }}
            
            <label for="fileUpload" class="mt-3 block text-sm font-medium text-gray-700">Uploader une image</label>
            <input type="file" id="fileUpload" class="mt-1 block w-full text-sm text-gray-700 border border-gray-300 rounded-md cursor-pointer focus:outline-none bg-white p-2">
            <p class="text-xs text-gray-500 mt-1">L'image sera envoyée sur Cloudinary et remplacera l'URL ci-dessus.</p>
        </div>

        <div>
            {{ form_label(form.price, 'Prix (€)', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.price, {'attr': {'class': 'mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500'}}) }}
        </div>

        <div>
            {{ form_label(form.description, 'Description', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.description, {'attr': {'class': 'mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500 h-32'}}) }}
        </div>

        <div>
            {{ form_label(form.nbCopies, 'Stock disponible', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.nbCopies, {'attr': {'class': 'mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500'}}) }}
        </div>

        <div>
            {{ form_label(form.categories, 'Catégories', {'label_attr': {'class': 'block text-sm font-medium text-gray-700'}}) }}
            {{ form_widget(form.categories, {'attr': {'class': 'mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500'}}) }}
        </div>

        <div class="flex justify-end">
            <button type="submit" class="px-6 py-2 bg-indigo-600 text-white font-medium rounded-md hover:bg-indigo-700 transition">
                Ajouter le produit
            </button>
        </div>
    {{ form_end(form) }}
</div>

<script>
    $("#fileUpload").on("change", function()
    {
        var file = this.files[0];
        var formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", "ShopLite");

        $.ajax({
            url: "https://api.cloudinary.com/v1_1/druglzlvw/image/upload",
            type: "POST",
            data: formData,
            processData: false,
            contentType: false,
            success: function(res)
            {
                //console.log("Upload success: ", res.secure_url);
                $("#product_image").val(res.secure_url);
            },
            error: function(err)
            {
                console.error("Upload error: ", err);
            }
        });
    });
</script>
{% endblock %}

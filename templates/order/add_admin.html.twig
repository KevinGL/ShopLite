{% extends 'base.html.twig' %}

{% block title %}Ajouter une commande{% endblock %}

{% block body %}
<div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-8 mt-10">
    <h1 class="text-2xl font-bold text-gray-900 mb-6">Ajouter une commande</h1>

    <datalist id="list_users">
        {% for user in users %}
            <option value="{{ user.username }}"></option>
        {% endfor %}
    </datalist>

    {{ form_start(form, {attr: {class: "space-y-6"}}) }}
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {{ form_row(form.createdAt, {
                row_attr: {class: "flex flex-col"},
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
            {{ form_row(form.goAt, {
                row_attr: {class: "flex flex-col"},
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
            {{ form_row(form.deliveredAt, {
                row_attr: {class: "flex flex-col"},
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
        </div>

        <div>
            {{ form_row(form.userInput, {
                attr: {class: "w-full p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
        </div>

        <div class="mt-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Recherche produit par mot-clé</h3>
            <input type="text" id="search_product"
                   class="w-full p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500 mb-3"
                   placeholder="Tapez un mot-clé (ex: iPhone, chaise, livre...)" />
            <select name="select_products" id="select_products" multiple
                    class="w-full h-40 p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500">
            </select>
        </div>

        {{ form_row(form.selectProducts) }}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {{ form_row(form.address, {
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
            {{ form_row(form.zipCode, {
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
            {{ form_row(form.city, {
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
            {{ form_row(form.phoneNumber, {
                attr: {class: "p-2 rounded-md border border-gray-400 bg-gray-50 focus:ring-2 focus:ring-indigo-500"}
            }) }}
        </div>

        <div class="pt-6">
            {{ form_widget(form.save, {attr: {class: "w-full md:w-auto bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-6 py-3 rounded-lg shadow"}}) }}
        </div>
    {{ form_end(form) }}
</div>

<script>

$("#search_product").on("input", (e) =>
{
    $.get("/api/products/search_by_word/" + e.target.value, (res) =>
    {
        if(res.message && res.message.length < 50)
        {
            $("#order_admin_selectProducts").show();

            res.message.map((p) =>
            {
                const o = new Option(p.name, p.id);
                $(o).html(p.name);

                $("#select_products").append(o);
            });
        }

        else
        {
            $("#order_admin_selectProducts").hide();
        }
    });
});

$("#select_products").change((e) =>
{
    const selectedValues = $("#select_products").val();

    $("#order_admin_selectProducts").val(selectedValues);
});

</script>
{% endblock %}
